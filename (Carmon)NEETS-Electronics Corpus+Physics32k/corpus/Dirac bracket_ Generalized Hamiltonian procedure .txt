In Lagrangian mechanics, if the system has holonomic constraints, then one generally adds Lagrange multipliers to the Lagrangian to account for them. The extra terms vanish when the constraints are satisfied, thereby forcing the path of stationary action to be on the constraint surface. In this case, going to the Hamiltonian formalism introduces a constraint on phase space in Hamiltonian mechanics, but the solution is similar.
Before proceeding, it is useful to understand the notions of weak equality and strong equality. Two functions on phase space, f and g, are weakly equal if they are equal when the constraints are satisfied, but not throughout the phase space, denoted f ≈ g. If f and g are equal independently of the constraints being satisfied, they are called strongly equal, written f = g. It is important to note that, in order to get the right answer, no weak equations may be used before evaluating derivatives or Poisson brackets.
The new procedure works as follows, start with a Lagrangian and define the canonical momenta in the usual way. Some of those definitions may not be invertible and instead give a constraint in phase space (as above). Constraints derived in this way or imposed from the beginning of the problem are called primary constraints. The constraints, labeled φj, must weakly vanish, φj (p,q) ≈ 0.
Next, one finds the naive Hamiltonian, H, in the usual way via a Legendre transformation, exactly as in the above example. Note that the Hamiltonian can always be written as a function of qs and ps only, even if the velocities cannot be inverted into functions of the momenta.