As of 2007, there is almost universal agreement in the astrophysics community that the long-duration bursts are associated with the deaths of massive stars in a specific kind of supernova-like event commonly referred to as a collapsar or hypernova. Very massive stars are able to fuse material in their centers all the way to iron, at which point a star cannot continue to generate energy by fusion and collapses, in this case, immediately forming a black hole. Matter from the star around the core rains down towards the center and (for rapidly rotating stars) swirls into a high-density accretion disk. The infall of this material into the black hole drives a pair of jets out along the rotational axis, where the matter density is much lower than in the accretion disk, towards the poles of the star at velocities approaching the speed of light, creating a relativistic shock wave at the front. If the star is not surrounded by a thick, diffuse hydrogen envelope, the jets' material can pummel all the way to the stellar surface. The leading shock actually accelerates as the density of the stellar matter it travels through decreases, and by the time it reaches the surface of the star it may be traveling with a Lorentz factor of 100 or higher (that is, a velocity of 0.9999 times the speed of light). Once it reaches the surface, the shock wave breaks out into space, with much of its energy released in the form of gamma-rays.
Three very special conditions are required for a star to evolve all the way to a gamma-ray burst under this theory: the star must be very massive (probably at least 40 Solar masses on the main sequence) to form a central black hole in the first place, the star must be rapidly rotating to develop an accretion torus capable of launching jets, and the star must have low metallicity in order to strip off its hydrogen envelope so the jets can reach the surface. As a result, gamma-ray bursts are far rarer than ordinary core-collapse supernovae, which only require that the star be massive enough to fuse all the way to iron.