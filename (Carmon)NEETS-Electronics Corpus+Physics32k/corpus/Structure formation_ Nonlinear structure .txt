When the perturbations have grown sufficiently, a small region might become substantially denser than the mean density of the universe. At this point, the physics involved becomes substantially more complicated. When the deviations from homogeneity are small, the dark matter may be treated as a pressureless fluid and evolves by very simple equations. In regions which are significantly denser than the background, the full Newtonian theory of gravity must be included. (The Newtonian theory is appropriate because the masses involved are much less than those required to form a black hole, and the speed of gravity may be ignored as the light-crossing time for the structure is still smaller than the characteristic dynamical time.) One sign that the linear and fluid approximations become invalid is that dark matter starts to form caustics in which the trajectories of adjacent particles cross, or particles start to form orbits. These dynamics are best understood using N-body simulations (although a variety of semi-analytic schemes, such as the Pressâ€“Schechter formalism, can be used in some cases). While in principle these simulations are quite simple, in practice they are tough to implement, as they require simulating millions or even billions of particles. Moreover, despite the large number of particles, each particle typically weighs 109 solar masses and discretization effects may become significant. The largest such simulation as of 2005 is the Millennium simulation.
The result of N-body simulations suggests that the universe is composed largely of voids, whose densities might be as low as one-tenth the cosmological mean. The matter condenses in large filaments and haloes which have an intricate web-like structure. These form galaxy groups, clusters and superclusters. While the simulations appear to agree broadly with observations, their interpretation is complicated by the understanding of how dense accumulations of dark matter spur galaxy formation. In particular, many more small haloes form than we see in astronomical observations as dwarf galaxies and globular clusters. This is known as the galaxy bias problem, and a variety of explanations have been proposed. Most account for it as an effect in the complicated physics of galaxy formation, but some have suggested that it is a problem with our model of dark matter and that some effect, such as warm dark matter, prevents the formation of the smallest haloes.